### 멀티캠퍼스 인공지능 자연어처리[NLP]기반 기업 데이터 분석.
- 2주차 2일 (5/18)
---
> # 1. PANDAS(이어서)
>> ## DataFrame
>> - 2차원 테이블 데이터 구조, 엑셀(스프레드시트)과 비슷하다.
>>> ```Python
>>> sales_data = {
>>>  '연도':[2015, 2016, 2017, 2018, 2019, 2020],
>>>  '판매량':[103, 70, 130, 160, 190, 230],
>>>  '매출':[500000, 300000, 400000, 550000, 700000, 680000],
>>>  '순이익':[370000, 190000, 300000, 480000, 600000, 590000]
>>> }
>>> 
>>> df = pd.DataFrame(sales_data)
>>> """
>>>      연도  판매량   매출    순이익
>>> 0   2015   103   500000   370000
>>> 1   2016    70   300000   190000
>>> 2   2017   130   400000   300000
>>> 3   2018   160   550000   480000
>>> 4   2019   190   700000   600000
>>> 5   2020   230   680000   590000
>>> """
>>> ```
>> ## 날짜 함수
>> 날짜 형식
>> - yyyy-mm-dd
>> 
>> - yyyy/mm/dd
>> 
>> - yyyy.mm.dd
>> 
>> - mm-dd-yyyy
>> 
>> - mm/dd/yyyy
>> 
>>> ```Python
>>> # 날짜 자동 생성
>>> print(pd.date_range(start='2021-05-15', end='2021-05-18'))
>>> # DatetimeIndex(['2021-05-15', '2021-05-16', '2021-05-17', '2021-05-18'], dtype='datetime64[ns]', freq='D')
>>> 
>>> #기간 사용
>>> print(pd.date_range(start='2021-05-18', periods=7))
>>> """
>>> DatetimeIndex(['2021-05-18', '2021-05-19', '2021-05-20', '2021-05-21',
>>>                '2021-05-22', '2021-05-23', '2021-05-24'],
>>>               dtype='datetime64[ns]', freq='D')
>>> """  
>>> 
>>> #증감
>>> pd.date_range(start='2021-05-18', periods=7, freq='2D')
>>> """
>>> DatetimeIndex(['2021-05-18', '2021-05-20', '2021-05-22', '2021-05-24',
>>>                '2021-05-26', '2021-05-28', '2021-05-30'],
>>>               dtype='datetime64[ns]', freq='2D')
>>> """
>>> pd.date_range(start='2021-05-18', periods=7, freq='W')
>>> """
>>> DatetimeIndex(['2021-05-23', '2021-05-30', '2021-06-06', '2021-06-13',
>>>                '2021-06-20', '2021-06-27', '2021-07-04'],
>>>               dtype='datetime64[ns]', freq='W-SUN')
>>> """
>>> 
>>> #날짜형
>>> x = pd.to_datetime(['2021-05-18 03:45', '2021-12-24 23:59'])
>>> #DatetimeIndex(['2021-05-18 03:45:00', '2021-12-24 23:59:00'], dtype='datetime64[ns]', freq=None)
>>> 
>>> x.year
>>> # Int64Index([2021, 2021], dtype='int64')
>>> 
>>> x.weekday
>>> # Int64Index([1, 4], dtype='int64')
>>> 
>>> diff = x - pd.to_datetime('2021-06-18 15:39')
>>> # TimedeltaIndex(['-32 days +12:06:00', '189 days 08:20:00'], dtype='timedelta64[ns]', freq=None)
>>> ```
>> ## CSV 파일 읽기/쓰기
>> - 콤마로 데이터가 분리되어있는 텍스트 파일
>> ```CSV
>> %%writefile sales_data.csv CSV
>> 연도,판매량,매출,순익
>> 2015,103,500000,370000
>> 2016,70,300000,190000
>> 2017,130,400000,300000
>> 2018,60,550000,480000
>> 2019,190,700000,600000
>> 2020,230,680000,590000
>> ```
>> ## 파일 읽기
>>> ```Python 
>>> sales_data = pd.read_csv('sales_data.csv', index_col='연도', header=0, sep=',')
>>> # index_col : 인덱스 칼럼
>>> # header : csv에 헤더가 있을경우 0, 없으면 None
>>> # sep : 데이터를 분리하는 기호(기본값 : ',' , 문자열 사이?)
>>>
>>> # 파일 쓰기
>>> sales_data.to_csv('sales_data_save.csv', encoding='utf-8')
>>> # encoding : 인코딩
>>> ```
>> ## 데이터(Column) 추가
>>> ```Python
>>> def check(n):
>>>     if n > 80:
>>>         return '높음'
>>>     else :
>>>         return '낮음'
>>> 
>>> sales_data = {
>>>  '연도':[2015, 2016, 2017, 2018, 2019, 2020],
>>>  '판매량':[103, 70, 130, 160, 190, 230],
>>>  '매출':[500000, 300000, 400000, 550000, 700000, 680000],
>>>  '순이익':[370000, 190000, 300000, 480000, 600000, 590000]
>>> }
>>> 
>>> sales_data = pd.DataFrame(sales_data)
>>> sales_data['순이익율'] = (sales_data['순이익']/sales_data['매출']) * 100
>>> 
>>> sales_data['순이익율_비교'] = sales_date['순이익율'].apply(check)
>>> # 함수대신 람다 사용도 가능하다.
>>> # sales_data['순이익율_비교'] = sales_data['순이익율'].apply(lambda x:'높음' if x > 80 else '낮음')
>>> 
>>> print(sales_data)
>>> """
>>> 연도	판매량	매출	순이익	순이익율	순이익율_비교
>>> 0	2015	103	500000	370000	74.000000	낮음
>>> 1	2016	70	300000	190000	63.333333	낮음
>>> 2	2017	130	400000	300000	75.000000	낮음
>>> 3	2018	160	550000	480000	87.272727	높음
>>> 4	2019	190	700000	600000	85.714286	높음
>>> 5	2020	230	680000	590000	86.764706	높음
>>> """
>> ## 데이터(Column)추가 2
>>> ```Python
>>> # 인덱스에 조건 가능
>>> sales_data[sales_data['매출'] > 300000]
>>> 
>>> # 해당 조건에 일치하는것만 데이터 변경 np.where(조건, True일경우, False일경우)
>>> sales_data['테스트1'] = np.where(sales_data['판매량'] > 200, 0, sales_data['판매량'])
>>> 
>>> # 해당 조건에 일치하는것만 바꾸고 나머지는 NaN
>>> sales_data['테스트2'] = sales_data[sales_data['판매량'] < 100]['판매량'] + 50
>>> 
>>> # 행추가
>>> sales_data.loc[6] = [2021, 720000,650000, 360, 0, 0]
>>> sales_data.loc[7] = sales_data.loc[5] + 100
>>> """
>>> 연도	판매량	매출	순이익	테스트1	테스트2	순이익율	순이익율_비교
>>> 0	2015.0	103.0	500000.0	370000.0	103.0	NaN	74.000000	낮음
>>> 1	2016.0	70.0	300000.0	190000.0	70.0	120.0	63.333333	낮음
>>> 2	2017.0	130.0	400000.0	300000.0	130.0	NaN	75.000000	낮음
>>> 3	2018.0	160.0	550000.0	480000.0	160.0	NaN	87.272727	높음
>>> 4	2019.0	190.0	700000.0	600000.0	190.0	NaN	85.714286	높음
>>> 5	2020.0	230.0	680000.0	590000.0	0.0	NaN	86.764706	높음
>>> 6	2021.0	720000.0	650000.0	360.0	0.0	0.0	0.055385	낮음
>>> 7	2120.0	330.0	680100.0	590100.0	100.0	NaN	86.766652	높음
>>> """
>> # 데이터 병합
>>> ```Python
>>> sales_data1 = {
>>>  '연도':[2015, 2016, 2017, 2018],
>>>  '판매량':[103, 70, 130, 160],
>>>  '매출':[500000, 300000, 400000, 550000],
>>>  '순이익':[370000, 190000, 300000, 480000]
>>> }
>>> sales_data2 = {
>>>  '연도':[2019, 2020],
>>>  '판매량':[190, 230],
>>>  '매출':[700000, 680000],
>>>  '순이익':[ 600000, 590000]
>>> }
>>> 
>>> sales_df1 = pd.DataFrame(sales_data1)
>>> """
>>>      연도  판매량      매출     순이익
>>> 0  2015  103  500000  370000
>>> 1  2016   70  300000  190000
>>> 2  2017  130  400000  300000
>>> 3  2018  160  550000  480000
>>> """
>>> sales_df2 = pd.DataFrame(sales_data2)
>>> """
>>>      연도  판매량      매출     순이익
>>> 0  2019  190  700000  600000
>>> 1  2020  230  680000  590000
>>> """
>>> # append
>>> sales_df1.append(sales_df2, ignore_index=True) #인덱스 새로설정 False 면 원래쓰던 인덱스 사용,  axis = 1 열방향 결합
>>> # sales_df1.append(sales_df2, ignore_index=False)
>>> # 합친 값을 sales_df1에 저장하지는 않았다. 저장 할꺼면 sales_df1 = sales_df1.append(sales_df2, ignore_index=True) 사용
>>> """
>>> 	연도	판매량	매출	순이익
>>> 0	2015	103	500000	370000
>>> 1	2016	70	300000	190000
>>> 2	2017	130	400000	300000
>>> 3	2018	160	550000	480000
>>> 4	2019	190	700000	600000
>>> 5	2020	230	680000	590000
>>> """
>>> # concat
>>> pd.concat([sales_df1, sales_df2], ignore_index=True)#인덱스 새로설정 False 면 원래쓰던 인덱스 사용
>>> # pd.concat([sales_df1, sales_df2], ignore_index=False)
>>> # 합친 값을 sales_df1에 저장하지는 않았다. 저장 할꺼면 sales_df1 = pd.concat([sales_df1, sales_df2], ignore_index=True) 사용
>>> """
>>> 	연도	판매량	매출	순이익
>>> 0	2015	103	500000	370000
>>> 1	2016	70	300000	190000
>>> 2	2017	130	400000	300000
>>> 3	2018	160	550000	480000
>>> 4	2019	190	700000	600000
>>> 5	2020	230	680000	590000
>>> """
>>> 
>>> cost_data = {
>>>  '연도':[2015, 2016, 2017, 2018],
>>>  '이자':[1520, 1120, 1360, 1680],
>>>  '관리비':[650, 400, 750, 800],
>>>  '세금':[12000, 8900, 10900, 12800] }
>>> cost_data = pd.DataFrame(cost_data)
>>> """
>>>     연도    이자  관리비  세금
>>> 0  2015   1520   650   12000
>>> 1  2016   1120   400    8900
>>> 2  2017   1360   750   10900
>>> 3  2018   1680   800   12800
>>> """
>>> 
>>> """
>>> join
>>> 내부적으로 pandas.merge함수 사용
>>> 기본적으로 index를 사용해 left join
>>> 주로 merge사용
>>> # how(join) 옵션
>>> - inner : 공통항목
>>> - outrt : 모두 선택
>>> - left : 왼쪽 기준
>>> - right : 오른쪽 기준
>>> """
>>> sales_df = pd.concat([sales_df1, sales_df2], ignore_index=True)
>>> 
>>> print(pd.merge(sales_df, cost_data, on='연도', how='inner'))
>>> """
>>>      연도  판매량      매출     순이익    이자  관리비     세금
>>> 0  2015  103  500000  370000  1520  650  12000
>>> 1  2016   70  300000  190000  1120  400   8900
>>> 2  2017  130  400000  300000  1360  750  10900
>>> 3  2018  160  550000  480000  1680  800  12800
>>> """
>>> 
>>> print(pd.merge(sales_df, cost_data, on='연도', how='outer'))
>>> """
>>>      연도  판매량      매출     순이익      이자    관리비       세금
>>> 0  2015  103  500000  370000  1520.0  650.0  12000.0
>>> 1  2016   70  300000  190000  1120.0  400.0   8900.0
>>> 2  2017  130  400000  300000  1360.0  750.0  10900.0
>>> 3  2018  160  550000  480000  1680.0  800.0  12800.0
>>> 4  2019  190  700000  600000     NaN    NaN      NaN
>>> 5  2020  230  680000  590000     NaN    NaN      NaN
>>> """
>>> 
>>> print(pd.merge(sales_df, cost_data, on='연도', how='left'))
>>> """
>>>      연도  판매량      매출     순이익      이자    관리비       세금
>>> 0  2015  103  500000  370000  1520.0  650.0  12000.0
>>> 1  2016   70  300000  190000  1120.0  400.0   8900.0
>>> 2  2017  130  400000  300000  1360.0  750.0  10900.0
>>> 3  2018  160  550000  480000  1680.0  800.0  12800.0
>>> 4  2019  190  700000  600000     NaN    NaN      NaN
>>> 5  2020  230  680000  590000     NaN    NaN      NaN
>>> """
>>> 
>>> print(pd.merge(sales_df, cost_data, on='연도', how='right'))
>>> """
>>>      연도  판매량      매출     순이익    이자  관리비     세금
>>> 0  2015  103  500000  370000  1520  650  12000
>>> 1  2016   70  300000  190000  1120  400   8900
>>> 2  2017  130  400000  300000  1360  750  10900
>>> 3  2018  160  550000  480000  1680  800  12800
>>> """
>>> 
>>> ```
>> ## 데이터(Column) 삭제
>>> ```Python
>>> sales_data = {
>>>  '연도':[2015, 2016, 2017, 2018, 2019, 2020],
>>>  '판매량':[103, 70, 130, 160, 190, 230],
>>>  '매출':[500000, 300000, 400000, 550000, 700000, 680000],
>>>  '순이익':[370000, 190000, 300000, 480000, 600000, 590000]
>>> }
>>> sales_data = pd.DataFrame(sales_data)
>>> sales_data['테스트1'] = 'test1'
>>> sales_data['테스트2'] = 'test2'
>>> sales_data['테스트3'] = 'test3'
>>> print(sales_data)
>>> """
>>>    연도  판매량   매출  순이익  테스트1  테스트2  테스트3
>>> 0  2015  103  500000  370000   test1   test2   test3
>>> 1  2016   70  300000  190000   test1   test2   test3
>>> 2  2017  130  400000  300000   test1   test2   test3
>>> 3  2018  160  550000  480000   test1   test2   test3
>>> 4  2019  190  700000  600000   test1   test2   test3
>>> 5  2020  230  680000  590000   test1   test2   test3
>>> """
>>>  
>>> # del 키워드 사용
>>> del sales_data['테스트1']
>>> """
>>>    연도  판매량   매출  순이익   테스트2  테스트3
>>> 0  2015  103  500000  370000   test2    test3
>>> 1  2016   70  300000  190000   test2    test3
>>> 2  2017  130  400000  300000   test2    test3
>>> 3  2018  160  550000  480000   test2    test3
>>> 4  2019  190  700000  600000   test2    test3
>>> 5  2020  230  680000  590000   test2    test3
>>> """
>>> 
>>> # drop 함수사용, inplace 를 True 로 하여 원본에 적용
>>> sales_data.drop(['테스트2'], axis='columns', inplace=True) # 열방향 삭제시 axis = 1도 사용가능
>>> # axis = 0 or 'index' 는 행방향 삭제
>>> """
>>>    연도  판매량   매출  순이익   테스트3
>>> 0  2015  103  500000  370000   test3
>>> 1  2016   70  300000  190000   test3
>>> 2  2017  130  400000  300000   test3
>>> 3  2018  160  550000  480000   test3
>>> 4  2019  190  700000  600000   test3
>>> 5  2020  230  680000  590000   test3
>>> """
>>> 
>>> # 팬시를 활용하여 한번에 여러개 지우기
>>> sales_data.drop(sales_data.columns[[0, 2]], axis='columns', inplace=True) # 열방향 삭제시 axis = 1도 사용가능
>>> # axis = 0 or 'index' 는 행방향 삭제
>>> """
>>>    판매량   순이익   테스트3
>>> 0  103    370000   test3
>>> 1   70    190000   test3
>>> 2  130    300000   test3
>>> 3  160    480000   test3
>>> 4  190    600000   test3
>>> 5  230    590000   test3
>>> """
>>> 
>>> # 행삭제
>>> sales_data.drop(0, inplace=True)
>>> """
>>>    판매량   순이익   테스트3
>>> 1   70    190000   test3
>>> 2  130    300000   test3
>>> 3  160    480000   test3
>>> 4  190    600000   test3
>>> 5  230    590000   test3
>>> """
>>> # 행삭제
>>> sales_data.drop([3,4,5], inplace=True)
>>> """
>>>    판매량   순이익   테스트3
>>> 1   70    190000   test3
>>> 2  130    300000   test3
>>> """
>>> ```
>> ## Dataframe Multiindex
>>> ```Python
>>> df = pd.DataFrame(np.random.randint(1, 100, size=(4, 4)), index=[['A','A','B','B'],['a','b','a','b']], columns=[['가가','가가','나나','나나'],['가','나','가','나']])
>>> print(df)
>>> """
>>>      가가      나나    
>>>       가   나   가   나
>>> A  a  92   85   29   1
>>>    b   7   71   99  49
>>> B  a  68   23    3  14
>>>    b  47   95   51  14
>>> """
>>> df['가가']
>>> """
>>>     가  나
>>> A a 92  85
>>> b    7  71
>>> B a 68  23
>>> b   47  95
>>> """
>>> df.loc['A']
>>> """
>>>   가가      나나
>>>   가   나    가  나
>>> a 92   85   29   1
>>> b  7   71   99  49
>>> """
>>> print(df.index)
>>> """
>>> MultiIndex([('A', 'a'),
>>>             ('A', 'b'),
>>>             ('B', 'a'),
>>>             ('B', 'b')],
>>>            )
>>> """
>>> print(df.columns)
>>> """
>>> MultiIndex([('가가', '가'),
>>>             ('가가', '나'),
>>>             ('나나', '가'),
>>>             ('나나', '나')],
>>>            )
>>> """
>>> ```
>> ## GroupBy
>>> ```Python
>>> df = pd.DataFrame(np.random.randint(1, 100, size=(8, 2)), index=[['A창고','A창고','A창고','A창고','B창고','B창고','B창고','B창고'], ['사과','배','바나나','사과','사과','배','바나나','배']], columns=['판매','재고'])
>>> """
>>>             판매  재고
>>> A창고  사과   81  79
>>>          배   93  84
>>>       바나나  27   5
>>>        사과   61  46
>>> B창고  사과   57  78
>>>          배   74   5
>>>       바나나  55  16
>>>          배   21  10
>>> """
>>> 
>>> df.index.names = ['창고명','상품명']
>>> """
>>>                판매  재고
>>> 창고명 상품명        
>>> A창고    사과     81  79
>>>            배    93  84
>>>         바나나    27   5
>>>          사과     61  46
>>> B창고    사과     57  78
>>>            배    74   5
>>>        바나나     55  16
>>>            배    21  10
>>> """
>>> 
>>> print(df.groupby('창고명').sum())
>>> """
>>>        판매   재고
>>> 창고명          
>>> A창고   262  214
>>> B창고   207  109
>>> """
>>> 
>>> print(df.groupby('상품명').sum())
>>> """
>>>         판매   재고
>>> 상품명          
>>> 바나나    82   21
>>>    배    188   99
>>>  사과    199  203
>>> """
>>> 
>>> print(df.groupby(['창고명','상품명']).sum())
>>> """
>>>                판매   재고
>>> 창고명  상품명          
>>> A창고  바나나     27    5
>>>           배     93   84
>>>         사과    142  125
>>> B창고  바나나     55   16
>>>           배     95   15
>>>          사과    57   78
>>> """
>>> ```
>> ## sort_values
>>> ```python
>>> df = pd.DataFrame(np.random.randint(1, 100, size=(8, 2)), index=[['A창고','A창고','A창고','A창고','B창고','B창고','B창고','B창고'], ['사과','배','바나나','사과','사과','배','바나나','배']], columns=['판매','재고'])
>>> """
>>>             판매  재고
>>> A창고  사과   81  79
>>>          배   93  84
>>>       바나나  27   5
>>>        사과   61  46
>>> B창고  사과   57  78
>>>          배   74   5
>>>       바나나  55  16
>>>          배   21  10
>>> """
>>> df.sort_values(by="판매", ascending=True)
>>> # ascending=True 일때는 오름차순, ascending=False 일때는 내림차순
>>> """
>>>             판매  재고
>>> B창고 바나나  22  92
>>> A창고   사과  24  90
>>>         사과  41  40
>>> B창고     배  49  75
>>>         사과  68  66
>>>          배   73   8
>>> A창고     배  88  14
>>>        바나나 98  11
>>> """
>>> 
>>> df.sort_values(by=["판매", "재고"], ascending=[True, False])
>>> # 복수의 컬럼을 정렬 기준으로 삼을 땐 각각 정렬기준 옵션을 리스트 형식으로 반환 가능하다.
>>> """
>>>             판매  재고
>>> B창고 바나나  22  92
>>> A창고   사과  24  90
>>>         사과  41  40
>>> B창고     배  49  75
>>>         사과  68  66
>>>          배   73   8
>>> A창고     배  88  14
>>>        바나나 98  11
>>> """ 
>>> ```
>>
> # 2. Matplotlib
>> ## plot옵션
>> color : 선의 색조정
>>> color='red # red, blue, green 등의 색이름
>>> 
>>> color='r' #r, b, g, y, m, k 등 색이름 약자
>>> 
>>> color='#ff0000' # rgb 색상코드
>>
>> linestyle : 선의 모양
>>> linestyle='solid' # 실선 ('-')
>>> 
>>> linestyle='dashed' # 파선('--')
>>> 
>>> linestyle='dashdot' # 1점 쇄선('-.')
>>> 
>>> linestyle='dotted' # 점선 (':')
>>
>> ## 축의 범위 조정
>>> x축 :  plt.xlim(시작, 끝)
>>> 
>>> y축 :  plt.ylim(시작, 끝)
>>> 
>>> x, y축 :  plt.axis([x시작, x끝, y,시작 y끝])
>>
>> ## 폰트설정
>>> ```Python
>>> # plt.rc('font', family='AppleGothic') # mac
>>> plt.rc('font', family='Malgun Gothic') # window
>>> ```
>>> 
>>
>
